<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple AR Test - Meta Quest 3</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #000;
            color: white;
            font-family: Arial, sans-serif;
        }
        
        #info {
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
        }
        
        button:hover {
            background: #45a049;
        }
        
        button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        #log {
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div id="info">
        <h2>Simple AR Test</h2>
        <p id="status">Loading...</p>
        <button id="startAR">Start AR Test</button>
        <button id="startVR">Start VR Test</button>
    </div>
    
    <div id="log">
        <div>Debug Log:</div>
    </div>

    <script>
        let currentSession = null;
        let logDiv = document.getElementById('log');
        
        function log(message) {
            console.log(message);
            logDiv.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
            log('STATUS: ' + message);
        }
        
        async function testReferenceSpaces(session) {
            const spaces = ['local-floor', 'local', 'viewer', 'bounded-floor'];
            let workingSpace = null;
            
            for (const spaceName of spaces) {
                try {
                    log(`Testing reference space: ${spaceName}`);
                    const space = await session.requestReferenceSpace(spaceName);
                    log(`✓ ${spaceName} WORKS!`);
                    if (!workingSpace) {
                        workingSpace = { name: spaceName, space: space };
                    }
                } catch (error) {
                    log(`✗ ${spaceName} failed: ${error.message}`);
                }
            }
            
            return workingSpace;
        }
        
        async function startAR() {
            const button = document.getElementById('startAR');
            button.disabled = true;
            button.textContent = 'Starting AR...';
            
            try {
                if (!('xr' in navigator)) {
                    throw new Error('WebXR not available');
                }
                
                log('Checking AR support...');
                const supported = await navigator.xr.isSessionSupported('immersive-ar');
                log(`AR supported: ${supported}`);
                
                if (!supported) {
                    throw new Error('AR not supported');
                }
                
                updateStatus('Requesting AR session...');
                
                // Try with absolutely minimal requirements
                const session = await navigator.xr.requestSession('immersive-ar');
                log('✓ Got AR session!');
                
                currentSession = session;
                updateStatus('Testing reference spaces...');
                
                const workingSpace = await testReferenceSpaces(session);
                
                if (!workingSpace) {
                    throw new Error('No reference spaces work');
                }
                
                updateStatus(`AR SUCCESS! Using ${workingSpace.name}`);
                log(`🎉 AR is working with ${workingSpace.name}!`);
                
                button.textContent = 'Exit AR';
                button.onclick = () => {
                    session.end();
                };
                
                session.addEventListener('end', () => {
                    log('AR session ended');
                    currentSession = null;
                    button.textContent = 'Start AR Test';
                    button.disabled = false;
                    button.onclick = startAR;
                    updateStatus('AR session ended');
                });
                
            } catch (error) {
                log(`❌ AR failed: ${error.message}`);
                updateStatus(`AR failed: ${error.message}`);
                button.textContent = 'Start AR Test';
                button.disabled = false;
            }
        }
        
        async function startVR() {
            const button = document.getElementById('startVR');
            button.disabled = true;
            button.textContent = 'Starting VR...';
            
            try {
                if (!('xr' in navigator)) {
                    throw new Error('WebXR not available');
                }
                
                log('Checking VR support...');
                const supported = await navigator.xr.isSessionSupported('immersive-vr');
                log(`VR supported: ${supported}`);
                
                if (!supported) {
                    throw new Error('VR not supported');
                }
                
                updateStatus('Requesting VR session...');
                
                const session = await navigator.xr.requestSession('immersive-vr');
                log('✓ Got VR session!');
                
                currentSession = session;
                updateStatus('Testing reference spaces...');
                
                const workingSpace = await testReferenceSpaces(session);
                
                if (!workingSpace) {
                    throw new Error('No reference spaces work');
                }
                
                updateStatus(`VR SUCCESS! Using ${workingSpace.name}`);
                log(`🎉 VR is working with ${workingSpace.name}!`);
                
                button.textContent = 'Exit VR';
                button.onclick = () => {
                    session.end();
                };
                
                session.addEventListener('end', () => {
                    log('VR session ended');
                    currentSession = null;
                    button.textContent = 'Start VR Test';
                    button.disabled = false;
                    button.onclick = startVR;
                    updateStatus('VR session ended');
                });
                
            } catch (error) {
                log(`❌ VR failed: ${error.message}`);
                updateStatus(`VR failed: ${error.message}`);
                button.textContent = 'Start VR Test';
                button.disabled = false;
            }
        }
        
        // Initialize
        document.getElementById('startAR').onclick = startAR;
        document.getElementById('startVR').onclick = startVR;
        
        // Check initial support
        if ('xr' in navigator) {
            Promise.all([
                navigator.xr.isSessionSupported('immersive-ar'),
                navigator.xr.isSessionSupported('immersive-vr')
            ]).then(([arSupported, vrSupported]) => {
                updateStatus(`Ready - AR: ${arSupported}, VR: ${vrSupported}`);
                log(`Device capabilities - AR: ${arSupported}, VR: ${vrSupported}`);
            });
        } else {
            updateStatus('WebXR not available');
        }
    </script>
</body>
</html>
